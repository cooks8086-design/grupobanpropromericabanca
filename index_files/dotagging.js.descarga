!function(){"use strict";const t="dataLayer";window[t]=window[t]||[],window.sendAscDataLayerInitEvent=function(){window.dispatchEvent(new Event("ascDataLayerInit",{cancelable:!1}))},window.sendAscDataLayerUpdatedEvent=function(){window.dispatchEvent(new Event("ascDataLayerUpdated",{cancelable:!1}))};class e{constructor(t,e){this._baseUrl=t,this._logger=e}async get(t,e){this._logger.debug("Sending HTTP GET to ",t);const n=new URL(`${t}?${e}`,this._baseUrl),i=await fetch(n.toString(),{headers:{accept:"application/json"},cache:"no-store"});return await i.json()}async post(t,e){this._logger.debug("Sending HTTP POST to ",t);const n=new URL(`${t}`,this._baseUrl),i=await fetch(n.toString(),{method:"POST",headers:{accept:"application/json","content-type":"application/x-www-form-urlencoded"},body:e,cache:"no-store"});return await i.json()}static getBaseUrlFromScript(){const t=document.currentScript;if(t&&"src"in t){const e=t.src;return new URL(e).origin}return""}}var n,i;!function(t){t.ClickToCall="click_to_call",t.CtaInteraction="cta_interaction",t.ElementConfiguration="element_configuration",t.ElementDisplayed="element_displayed",t.FormEngagement="form_engagement",t.FormSubmission="form_submission",t.MediaInteraction="media_interaction",t.NavInteraction="nav_interaction",t.PopupClose="popup_close",t.PopupOpen="popup_open",t.RetailProcess="retail_process",t.SpecialOffer="special_offer"}(n||(n={})),function(t){t.Unknown="",t.Start="start",t.Idle="idle",t.Timeout="timeout",t.Engage="engage",t.Close="close"}(i||(i={}));class s{static IsInputPartOfForm(t){if(t instanceof HTMLInputElement&&"text"===t.type||t instanceof HTMLTextAreaElement){if(t.dataset.dotaggingEvent===n.ElementConfiguration)return!1;if(t.closest(this.formSelectors))return!0}return!1}static IsCustomFormElement(t){return t instanceof HTMLDivElement&&t.classList.contains("dealerOnform")}static IsValidFormElement(t){return t instanceof HTMLFormElement||this.IsCustomFormElement(t)}static GetClosestFormElement(t){return t.closest(this.formSelectors)}static ThrottleDelay(t,e){setTimeout(e,t)}static DispatchTaggingEvent(t){window.dispatchEvent(new CustomEvent("dotagging.event",{bubbles:!0,detail:{data:t}}))}}s.formSelectors="form,  div.dealerOnform";class a{constructor(t){this.supportedCommands=["selector","script","literal"],this.supportedScripts=["geturl"],this.parseCommand(t)}parseCommand(t){const e=t.split("::");if(this.command=e[0],e.length>1){const t=e[1].split(",");this.primaryInstruction=t[0],t.length>1&&(this.secondaryInstruction=t[1])}if(e.length>2){const t=e[2].split(",");this.defaultInstruction=t[0],t.length>1&&(this.defaultSecondaryInstruction=t[1])}}get IsValid(){return!(!this.command||!this.primaryInstruction)&&(!("script"==this.command&&!this.supportedScripts.includes(this.primaryInstruction))&&this.supportedCommands.includes(this.command))}}var o,r=class{constructor(t){this.commands=[],this.isParsable=!1,this.item=t,this.parseCommands(t)}parseCommands(t){t.split("|").forEach((t=>{const e=new a(t);e.IsValid&&this.commands.push(e)})),this.commands.length>0&&(this.isParsable=!0)}get Value(){if(!this.isParsable)return this.item;let t="";for(const e of this.commands)switch(e.command){case"selector":let n=this.getElementValue(e.primaryInstruction,e.secondaryInstruction);!n&&e.defaultInstruction&&(n=this.getElementValue(e.defaultInstruction,e.defaultSecondaryInstruction)),t+=n;break;case"literal":t+=e.primaryInstruction;break;case"geturl":t+=window.location.href}return t||this.item}getElementValue(t,e){const n=document.querySelectorAll(t),i=[];return n.forEach((t=>{let n;if(e)n=e?.startsWith("data-")?t?.getAttribute(e):this.getElementValue(e);else if(t instanceof HTMLSelectElement){const e=t[t.selectedIndex].innerText;e&&(n=e)}else t instanceof HTMLInputElement?n=s.IsInputPartOfForm(t)?"***":t.value??t.textContent??t.innerText:t instanceof HTMLElement&&(n=t.textContent??t.innerText);n&&i.push(n)})),0==i.length?"":i.join(",")}};class l{constructor(){this.event="",this.context="",this.event_action_result="",this.event_owner="",this.product_name="",this.product_type="",this.product_type_version="",this.department="",this.element_state="",this.element_text="",this.element_value="",this.element_order="",this.element_type="",this.element_subtype="",this.element_color="",this.element_position="unknown",this.element_title="",this.item_id="",this.item_number="",this.item_price="",this.item_condition="",this.item_year="",this.item_location="",this.item_make="",this.item_model="",this.item_variant="",this.item_color="",this.item_category="",this.item_fuel_type="",this.item_inventory_date="",this.item_type="",this.item_payment="",this.item_order="",this.flow_name="",this.flow_stage="",this.flow_outcome=""}fillEventData(t){this.event=this.getDataValue(t.dataset.dotaggingEvent),this.searchDomForItems(t),Object.entries(this).forEach((([e,n])=>{if(!n)switch(e){case"element_color":this[e]=this.getDataValue(t.dataset[`dotagging${this.getKeyName(e)}`],this.getElementColor(t));break;case"element_value":this[e]=this.getDataValue(t.dataset[`dotagging${this.getKeyName(e)}`],this.getElementValue(t));break;case"element_text":this[e]=this.getDataValue(t.dataset[`dotagging${this.getKeyName(e)}`],this.getElementText(t));break;case"element_title":this[e]=this.getDataValue(t.dataset[`dotagging${this.getKeyName(e)}`],this.getElementTitle(t));break;case"link_url":this[e]=this.getDataValue(t.dataset[`dotagging${this.getKeyName(e)}`],t?.href);break;default:this[e]=this.getDataValue(t.dataset[`dotagging${this.getKeyName(e)}`])}}))}getDataValue(t,e=""){return t?new r(t).Value??e:e}getElementColor(t){const e=window.getComputedStyle(t).getPropertyValue("background-color").match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(,\s*\d+\.*\d*)?\)$/);return e?0===parseFloat(e[4]?.replace(",","")?.trim())?"#00":"#"+[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])].map((t=>{const e=t.toString(16);return 1===e.length?"0"+e:e})).join(""):""}getElementValue(t){return s.IsInputPartOfForm(t)?"***":t instanceof HTMLInputElement||t instanceof HTMLSelectElement?this.getDataValue(t.dataset.dotaggingElementValue,t.value):this.getDataValue(t.dataset.dotaggingElementValue)}getElementText(t){let e=(t.textContent??t.innerText).trim();if(t instanceof HTMLFormElement){const e=t.dataset.dotaggingFormName?.split("-")[1]?.trim()??"";return this.getDataValue(e)}return t instanceof HTMLSelectElement&&(e=t.options[t.selectedIndex].text),t instanceof HTMLInputElement&&(e="button"===t.type.toLowerCase()?t.value:"submit"===t.type.toLowerCase()?t.getAttribute("value")??t.value:"checkbox"===t.type.toLowerCase()?document.querySelector(`label[for="${t.id}"]`)?.textContent??e:t.placeholder),t instanceof HTMLImageElement&&(e=t.alt),"i"===t.tagName.toLowerCase()&&(e=t.getAttribute("alt")??e),""===e&&(e=this.findElementTextInImageAndIconChildren(t)??t.getAttribute("aria-label")??""),this.getDataValue(t.dataset.dotaggingElementText,e)}findElementTextInImageAndIconChildren(t){const e=t.querySelectorAll("img[data-dotagging-element-text], i[data-dotagging-element-text]");if(e.length>0)return e[0].dataset.dotaggingElementText;const n=t.querySelectorAll("img[alt]:not([alt='']), i[alt]:not([alt=''])");return n.length>0?n[0].getAttribute("alt"):null}getElementTitle(t){const e=document.querySelector(`[for="${t.id}"]`);let n="";return e&&(n=e.textContent??e.innerHTML),n||(t instanceof HTMLInputElement&&(n=t.placeholder),t instanceof HTMLSelectElement&&(n=t.options[t.selectedIndex].text)),this.getDataValue(t.dataset.dotaggingElementValue,n)}searchDomForItems(t){const e=new Map,n="dotagging";let i=t;for(;null!==i;){for(const t of Object.keys(i.dataset))if(t.startsWith(n)){const s=t.replace(n,""),a=this.getKeyName(s);Object.keys(this).includes(a)&&!e.has(a)&&e.set(a,this.getDataValue(i.dataset[t]))}i=i.parentElement}e.forEach(((t,e)=>{this[e]=t}))}getKeyName(t){return`${t.split(/(?=[A-Z])/).join("_").toLocaleLowerCase()}`}}class c extends l{constructor(t){super(),this.event_action="click",this.link_url="",this.promotion_name="",this.audience="",this.item_recommended="",super.fillEventData(t)}}class m extends l{constructor(t){super(),this.event_action="click",this.comm_phone_number="",this.affiliation="",this.item_recommended="",super.fillEventData(t)}}class d extends l{constructor(t){super(),this.event_action="click",this.link_url="",this.item_recommended="",super.fillEventData(t)}}class g extends l{constructor(t){super(),this.event_action="view",this.department="",this.promotion_name="",super.fillEventData(t)}}class h extends l{constructor(t){super(),this.event_action="click",this.event_action_result="calc",this.form_name="",this.form_type="",this.comm_type="",this.comm_status="",this.product_name="Website",this.item_recommended="",super.fillEventData(t)}}class u extends l{constructor(t){super(),this.event_action="click",this.event_action_result="complete",this.submission_id="",this.form_name="",this.form_type="",this.comm_outcome="opportunity",this.comm_type="",this.item_recommended="",super.fillEventData(t),"appointment"===this.form_type&&(this.comm_outcome="appt_booked")}}class p extends l{constructor(t){super(),this.event_action="click",this.affiliation="",this.media_type="",this.link_url="",this.creative_name="",this.item_recommended="",super.fillEventData(t)}}class _ extends l{constructor(t){super(),this.event_action="click",this.link_url="",super.fillEventData(t)}}class v extends l{constructor(t){super(),this.page_type="",this.event_action="view",this.event_action_result="close",super.fillEventData(t)}}class E extends l{constructor(t){super(),this.page_type="",this.event_action="view",this.event_action_result="open",super.fillEventData(t)}}class f extends l{constructor(t){super(),this.event_action="click",super.fillEventData(t)}}class w extends l{constructor(t){super(),this.event_action="view",this.promotion_id="",this.promotion_name="",this.audience="",super.fillEventData(t)}}!function(t){t.Idle="idle",t.Timeout="timeout"}(o||(o={}));class y{constructor(t){this._watchType=o.Idle,this._intervalId=0,this.setWatcherCommStatus=t=>{this.FormElem.dataset.dotaggingCommStatus=t},this.getInterval=()=>this._watchType===o.Idle?parseInt(this.FormElem.dataset.dotaggingIdle??"60000"):parseInt(this.FormElem.dataset.dotaggingTimeout??"300000"),this.FormElem=t}start(t=o.Idle){this._intervalId=window.setInterval((()=>{switch(t){case o.Idle:{this.setWatcherCommStatus(i.Idle);const t=new h(this.FormElem);this.SendEvent(t),this.stop(),this.start(o.Timeout)}break;case o.Timeout:{this.setWatcherCommStatus(i.Timeout);const t=new h(this.FormElem);this.SendEvent(t),this.stop()}break;default:this.stop()}}),this.getInterval())}SendEvent(t){s.DispatchTaggingEvent(t)}stop(){window.clearInterval(this._intervalId),this._intervalId=0}}const b="1"==new URLSearchParams(window.location.search).get("dotagging_debug"),S=new class{debug(...t){b&&console.debug("[dotagging:debug]",...t)}info(...t){b&&console.info("[dotagging:info]",...t)}warn(...t){b&&console.warn("[dotagging:warning]",...t)}error(...t){b&&console.warn("[dotagging:error]",...t)}},I=new e(e.getBaseUrlFromScript(),S),T=new class{constructor(t){this._apiService=t}getData(t){const{dealerId:e,pageId:n,items:i,pageType:s,itemCount:a,statusCode:o}=t,r=new URLSearchParams;if(r.set("dealerId",e.toString()),r.set("pageId",n.toString()),r.set("pageType",s),r.set("statusCode",o?.toString()||""),void 0!==a&&r.set("itemCount",a.toString()),null!=i)for(const t of i)r.append("item",t);const l=new Date,c=(l.getMonth()+1).toString().padStart(2,"0")+l.getDate().toString().padStart(2,"0")+l.getFullYear().toString()+l.getHours().toString().padStart(2,"0");return r.set("timestamp",c),this._apiService.post("/DataLayer/Init",r)}}(I),L=new class{constructor(t){this._logger=t}push(e){this._logger.info("Pushing data onto the data layer:",e),window[t].push(e)}get name(){return t}}(S),C=new class{constructor(t,e){this._initialized=!1,this._dataLayer=t,this._logger=e}init(){this._initialized||(this.attachListener(),this._initialized=!0)}attachListener(){this._logger.debug("Initializing low level event API service"),window.addEventListener("dotagging.event",(t=>{this._logger.debug("Low level event API received event",t);const e=t?.detail?.data??null;if(!e||!e.event)return void console.error("dotagging event data is missing");const{event:n}=e,i=n.startsWith("do.")?n:`do.${n}`;this._dataLayer.push({event:i,do:{...e}})}))}}(L,S),F=new class{constructor(){this._watchedForms=new Array}find(t){return this._watchedForms.find((e=>e.FormElem.id===t.id))}start(t){if(s.IsValidFormElement(t)){let e=this.find(t);e||(e=new y(t),e.start(),this._watchedForms.push(e))}}stop(t){if(s.IsValidFormElement(t)){const e=this.find(t);e&&e.stop()}}delete(t){const e=this._watchedForms.findIndex((e=>e.FormElem.id===t.FormElem.id));this._watchedForms.splice(e,1)}},D=new class{constructor(t,e,a){this._taggingEventAttribute="data-dotagging-event",this._initialized=!1,this.formEngagementSubmitEventListener=t=>{t.preventDefault();const e=t.target,a=s.GetClosestFormElement(e),o=t instanceof SubmitEvent?t.submitter:t.target;this.setFormCommStatus(a,i.Close);const r=this.createEventByType(a);r.event_action="click",r.element_text=o instanceof HTMLInputElement?o.value:o.innerText,this.sendEvent(a,r),this._formWatcherService.stop(a);const l=new u(o);l.event=n.FormSubmission,l.element_type="form",l.element_subtype="cta_button",l.event_action="click",l.event_action_result="complete",this.sendEvent(a,l)},this._lowLevelEventService=t,this._formWatcherService=e,this._logger=a,this.boundFormEngagementInputChangeEventHandler=this.formEngagementInputChangeEventListener.bind(this),this.boundFormEngagementSubmitEventHandler=this.formEngagementSubmitEventListener.bind(this)}init(){"loading"!==document.readyState?this.initEvents():document.addEventListener("DOMContentLoaded",(()=>{this.initEvents()}))}initEvents(){if(!this._initialized){this._lowLevelEventService.init();const t=[...document.querySelectorAll(`[${this._taggingEventAttribute}]`)];this.attachEvents(t),this.initDynamicElementObserver(),this.initDisplayElementObserver(),this._initialized=!0,this._logger.debug("DOM event service initialized")}}initDynamicElementObserver(){const t=t=>{const e="[data-dotagging-product-name]";if("vehicleCompare"===t.target?.id){for(const i of t.addedNodes)if(i instanceof HTMLElement&&i.matches(e)){const t=new E(i);t.event=n.PopupOpen,t.product_name="SRP2.0|Compare",t.page_type="compare_page",s.ThrottleDelay(500,(()=>{this.sendEvent(i,t)}))}for(const i of t.removedNodes)if(i instanceof HTMLElement&&i.matches(e)){const t=new v(i);t.event=n.PopupClose,s.ThrottleDelay(500,(()=>{this.sendEvent(i,t)}))}}};new MutationObserver((e=>{for(const n of e)"childList"===n.type?(n.addedNodes.forEach((t=>{if(t instanceof HTMLElement){const e=[...t.querySelectorAll(`[${this._taggingEventAttribute}]`)];t.hasAttribute(`${this._taggingEventAttribute}`)&&e.push(t),this.attachEvents(e)}})),t(n)):"attributes"===n.type&&n.attributeName===this._taggingEventAttribute&&n.target instanceof HTMLElement&&n.target.hasAttribute(`${this._taggingEventAttribute}`)&&this.attachEvents([n.target])})).observe(document.body,{attributes:!0,childList:!0,subtree:!0}),this._logger.debug("Observing DOM changes for new events")}initDisplayElementObserver(){const t=`[data-dotagging-event="${n.ElementDisplayed}"],[data-dotagging-event="${n.SpecialOffer}"]`,e=document.querySelectorAll(`${t}`);if(e.length>0){const t=new IntersectionObserver((t=>{t.forEach((t=>{const e=t.target;if(t.isIntersecting){const t=this.createEventByType(e);this.sendEvent(e,t)}}))}),{root:null,rootMargin:"0px",threshold:.5});[...e].forEach((e=>{const n=e;"true"!==n.dataset.dotaggingEnabled&&(n.dataset.dotaggingEnabled="true",t.observe(e))}))}}formEngagementInputChangeEventListener(t){const e=t.target,a=s.GetClosestFormElement(e);this.checkForFormEngageStart(a),this.setFormCommStatus(a,i.Engage);const o=e;o.dataset.dotaggingEvent=n.FormEngagement,o.dataset.dotaggingCommStatus=i.Engage,o.dataset.dotaggingElementSubtype="input_field",o.dataset.dotaggingEventAction="field_input";const r=this.createEventByType(e);this.sendEvent(e,r)}checkForFormEngageStart(t){if(this.getFormCommStatus(t)==i.Timeout||this.getFormCommStatus(t)==i.Idle||this.getFormCommStatus(t)==i.Close||this.getFormCommStatus(t)==i.Unknown){this.setFormCommStatus(t,i.Start);const e=this.createEventByType(t);this.sendEvent(t,e),this._formWatcherService.start(t)}}setupDataEvent(t){if("true"!==t.dataset.dotaggingEnabled)switch(this._logger.debug("Observing element",t),t.dataset.dotaggingEvent){case n.ElementDisplayed:case n.RetailProcess:break;case n.SpecialOffer:this.initDisplayElementObserver();break;case n.FormEngagement:if(s.IsValidFormElement(t)&&(this.setFormCommStatus(t,i.Unknown),t.querySelectorAll("input:not([type=button]),select,textarea").forEach(((t,e)=>{t.dataset.dotaggingElementOrder=e.toString(),t.removeEventListener("change",this.boundFormEngagementInputChangeEventHandler,!0),t.addEventListener("change",this.boundFormEngagementInputChangeEventHandler,!0)})),t instanceof HTMLFormElement&&(t.dataset.dotaggingElementType="form",t.removeEventListener("submit",this.boundFormEngagementSubmitEventHandler,!0),t.addEventListener("submit",this.boundFormEngagementSubmitEventHandler,!0)),s.IsCustomFormElement(t))){const e=t.querySelector("input[type='button'][id='submit']");e.removeEventListener("click",this.boundFormEngagementSubmitEventHandler,!0),e.addEventListener("click",this.boundFormEngagementSubmitEventHandler,!0)}break;case n.FormSubmission:{const e=this.createEventByType(t);this.sendEvent(t,e),t.dataset.dotaggingEnabled="true"}break;default:{let e="click";(t instanceof HTMLInputElement&&"checkbox"===t.type||t instanceof HTMLInputElement&&"text"===t.type||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)&&(e="change"),t.addEventListener(e,(()=>{const e=this.createEventByType(t);this.sendEvent(t,e)})),t.dataset.dotaggingEnabled="true"}}}sendEvent(t,e){s.DispatchTaggingEvent(e)}attachEvents(t){t.forEach((t=>{this.setupDataEvent(t)}))}setFormCommStatus(t,e){t.dataset.dotaggingCommStatus=e}getFormCommStatus(t){return t.dataset.dotaggingCommStatus??""}createEventByType(t){switch(t.dataset.dotaggingEvent){case n.ClickToCall:return new m(t);case n.ElementConfiguration:return new d(t);case n.ElementDisplayed:return new g(t);case n.FormEngagement:return new h(t);case n.FormSubmission:return new u(t);case n.MediaInteraction:return new p(t);case n.NavInteraction:return new _(t);case n.RetailProcess:return new f(t);case n.SpecialOffer:return new w(t);case n.CtaInteraction:default:return new c(t)}}}(C,F,S),k=new class{constructor(t,e,n,i){this._dataLayer=t,this._initialDataService=e,this._eventService=n,this._logger=i}async initialize(){this._initGtm();const t=this._getTaggingData();if(null!=t)try{const e=await this._initialDataService.getData(t);this._dataLayer.push({event:e.event,do:{...e}}),this.sendPageViews(e.rollup_measurement_id,e.website_measurement_id?.trim()??"",e.website_additional_measurement_ids??"",e.website_dealer_on_controlled_measurement_ids??""),this._eventService.init(),this._logger.info("GTM tracker initialized")}catch(t){this._logger.error("GTM tracker failed to initialize",t)}else this._logger.warn("Unable to load tagging data. Events will not fire.")}_getTaggingData(){const t="script#dealeron_tagging_data[type='application/json']",e=document.querySelector(t);return null===e?(console.debug(`Missing tagging data element (${t})`),null):JSON.parse(e.innerHTML)}_initGtm(){this._logger.info("Initializing GTM"),this._dataLayer.push({event:"gtm.js","gtm.start":(new Date).getTime()});const t=document.createElement("script");t.async=!0;const e="https://www.googletagmanager.com/gtm.js?id=GTM-WBJPXB7";t.src="dataLayer"===this._dataLayer.name?e:`${e}&l=${this._dataLayer.name}`;const n=document.getElementsByTagName("script")[0];n.parentNode?.insertBefore(t,n)}sendPageViews(t,e,n,i){this._dataLayer.push({event:"do.pageview",do:{page_view_measurement_id:t}}),e.length>0&&this._dataLayer.push({event:"do.pageview",do:{page_view_measurement_id:e}});for(const t of n.split(",").map((t=>t.trim())).filter((t=>t!==e)))t.length>0&&this._dataLayer.push({event:"do.pageview",do:{page_view_measurement_id:t.trim()}});for(const t of i.split(",").map((t=>t.trim())).filter((t=>t!==e)))t.length>0&&this._dataLayer.push({event:"do.pageview",do:{page_view_measurement_id:t.trim()}})}}(L,T,D,S);(async()=>{await k.initialize(),S.debug("Tracker Initialized")})()}();