(function(d,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(d=typeof globalThis<"u"?globalThis:d||self,d.harmoniq=l())})(this,function(){"use strict";const d=r=>{let t={};return Object.keys(r).forEach(e=>{t[e]={partner:e,partnerProperties:r[e][e][0]}}),t},l=r=>{const t=r.split(";"),e={};return t.forEach(o=>{const n=o.split(":");e[n[0]]=n.slice(1).join(":")}),{version:e.version,assetsDomain:e.assetsDomain,provider:e.provider,meta:JSON.parse(e.meta)}},S=async(r,t="nonprod")=>{try{if(!r)throw new Error("websiteId is required to fetch package version");const e=t==="nonprod"?"https://do-nonprod-site-api.azure-api.net/v1/api/harmoniq/data":"https://api.dealeron.com/api/harmoniq/data",o=r.startsWith("do-")?r.substring(3):r,n=`?_=${P(5)}`,a=await fetch(`${e}/${o}${n}`);if(!a.ok)throw new Error(`Error ${a.status}: cannot fetch package version`);return await a.json()}catch(e){return e instanceof Error&&console.error(e.message),null}},A=(r,t,e)=>{const o={},n=new URLSearchParams(window.location.search);if(n.get("harmoniqInit")==="true")return k(t);for(const[a,c]of Object.entries(t))for(const[s,i]of Object.entries(c))if(Object.keys(e).includes(s)&&(e[s]===!0||Array.isArray(e[s])&&e[s].includes(r))){if(n.get(s)==="false")continue;o[a]||(o[a]={}),o[a][s]=i}return k(o)},k=r=>{const t=new URLSearchParams(window.location.search);if(t.get("singlePackage")){const e=t.get("singlePackage");return e&&r[e]?{[e]:r[e]}:{}}for(const e of Object.values(r))for(const o of Object.keys(e))t.get(o)==="false"&&delete r[o];return r},y=(r,t,e,o)=>{const n=d(r);let a=JSON.stringify(n).replace(/"/g,"&quot;");const c=`version:partner-packages-${t};assetsDomain:${e}/partner-packages;provider:${o};meta:${JSON.stringify(n)};partnerCardOptions:{};`,i=`<section id="partner-card" style="display:none;" model="subject" basel="${`version:partner-packages-${t};assetsDomain:${e}/partner-packages;provider:${o};meta:${a};partnerCardOptions:{};`}"></section>`;document.body.insertAdjacentHTML("beforeend",i),window.Co||(window.Co={util:{options:{prototype:{parse:l}}}}),C(c,t,e)},C=(r,t,e)=>{const o=document.createElement("link");o.rel="stylesheet",o.href=`${e}/partner-packages/partner-packages-${t}/baselDeploy/master.css`,document.body.insertAdjacentElement("beforeend",o);const n=document.createElement("script");n.src=`${e}/partner-packages/partner-packages-${t}/baselDeploy/basel.js`,document.body.insertAdjacentElement("beforeend",n),n.onload=()=>{window.Basel.initBasel(),window.Basel.initPartnersMeta(l(r))}},P=(r=5)=>{const t=new Date,e=t.getMinutes(),o=Math.round(e/r)*r;return t.setMinutes(o,0,0),Math.floor(t.getTime()/1e3)},x=r=>r?/^\d+\.\d+\.\d+$/.test(r):!1,T=()=>{var n;let r;const t=document.querySelector("#dealeron_tagging_data");if(!t||!t.innerHTML){console.error("dealeron_tagging_data script not found.");return}try{const a=JSON.parse(t.innerHTML);r=(n=a==null?void 0:a.items)==null?void 0:n[0]}catch(a){console.error("Failed to parse JSON from dealeron_tagging_data:",a);return}if(!r){console.error("No VIN found in tagging data.");return}const{origin:e}=window.location,o=`${e}/routevin.aspx?vin=${encodeURIComponent(r)}`;window.location.href=o},D={partnerShowcase:!0,logRocket:!0,flickFusion:!0,letzChat:!0,kord:!0,bannerInSite:!0,vidcalls:!0,roadster:!0,lyteflo:!0,dgAutoNationServiceAppt:!0,askOtto:!0,digitalAirstrike:!0,xTimeModal:!0,edmunds:["30998","28075","28052","26931","27582","27272","18534","28194","14034","27553","18469","28033","27964","27990","27291","28101","27356","27547","28043","27364","28054","27947","27239","27345","27319","28118","27329","28001","27255","28050","28341","27224","29175","29175","19677","27252","28831","28218","29622","28592","27299","29310","28867","24257","24433","24320","24289","24375","29189","30779","29324","29826","29761","29656","14835","19301","23701","23728","29216","30938","30941","30946","30935","30934","30957","30940","30939","30182","12861","22372","6320","18281","18305","13446","27821","14645","29665","21699","27257","9799","30892","30885","26684","23690","28291","30938","30940","20444","28413","29512","22447","30997","28547","29383","26891","23000","29282","22270","31451","12815","12816","23450"],phyron:!0,tvSquared:!0,carScore:!0,carScoreV2:!0,expressCTA:!0,netlook:!0,ftlaunchpadAiLptm:!0,dealerVision:!0,lectrium:!0,kenect:!0,ketch:!0,maxDigital:!0,offerLogix:!0,makeMyDeal:!0,recallMasters:!0,chargeway:!0,retailReady:!0,nexteppe:!0,concatSystems:!0,pureCars:!0,spinCar:!0,autoHook:!0,tikTok:!0,carNow:["29718","29720","18761","5776","25834","19274","28361","24782","24798","24800","24802","24801","29681","26452","28876","28359","29674","28876","29645","28720","30164","30160","28671","29819","24782","28274","24797","15885","25329","25345","25330","25316","24808","21397","29812","28015","30126","24296","17379","24397","25626","25627","18761","29777","30256","12360","20375","30885","30892","30894","25733","27868","29731","30998","27843","26494","26032","29827","29817","26480","19667","23056","18420","22076","22751","5592","16060","25500","17982","17924"],webBuy:!0,joyDrive:!0,pureVin:!0,capitalOne:!0,perq:!0,accessiBe:!0,carGurus:["28770","28210","26774","26775","28230","23321","24822","27225","28733","23329","13684","25796","25973","29312","27906","28081","27967","11595","11593","24289","29813","27524","28300","25891","29701","28379","24320","29818","29487","28598","29732","28840","10123","25890","21510","28843","29286","28513","29421","17455","27158","16823","11871","28928","29775","29552","18313","18549","17982","18020","18409","17924","18408","18428","18427","18034","18312","18426","18420","18425","18059","18316","18043","17918","14918","17012","22627","23245","27139","27124","23268","25458","17797","29351","19637","14981","14940","14943","19643","19607","14942","29824","27568","13069","28819"],kbbico:!0,dasToolbar:!0,dealereProcess:!0,dealereProcessChat:!0,complyAuto:["30998","30006","29247","28704","29425","26408","23329","22981","22984","22983","11814","11816","25498","21203","28494","28669","24431","24230","25457","25439","26063","17729","24585","26137","17722","26053","26136","30087","25461","29646","29664","29663","28589","4406","27487","28269","28260","15648","28257","28255","26739","28259","27500","21892","26727","26707","26706","26058","23799","30885","30892","30894","25733","10083","30763","30879","28596","16909","27391","27628","23227","23107","28004","30005","28973","28325","29338","27588","27310","29724","29721","29723","14906","14907","27299","19534","30182","26421","21958","28496","24827","24946","30083","23277","28526"],captureWerks:!0,autosOnVideo:!0,podium:["21058","20020","20444","21694","22118","26538","30160","30164","16451","15407","22909","17653","20433","17480","16865","16707","13144","17636","27588","27310","15554","25798","18705","27060","27918","15373","29769","14492","25284","25191","29339","28324","26939","28050","29280","14144","29942","22738","29504","29948","27988","21445","30770","19068","30775","26939","29824","27725","26150","30879","31344","31385","31365","28485","13400","13378","24580","19287","22682","24573","19309","19308","22937","28521","12591","15172","25484"],driveItNow:!0,activEngage:!0,motoFuze:!0,wistiaChannels:!0,wistiaPlayers:!0,dealerYak:!0,tradePending:["30945","30934","30939","30935","30946","31361","31355","31026","29817","29814","25935","20862","26646","17326","24211","27396","29761","30893","10083","25060","27445","30763","30940","30941","16225","30885","30892","30894","25733","30940","30938","30941","18590","30940","30941","30938","30957","31027","26042","31031","31025","31357","13691","27704","30787","27704","24431","12591","15172","9857","23029","12589","21175","26395"],darwinAutomotive:!0,autoLeadStar:!0,runMyLease:!0,clarivoy:!0,carFax:["28630","30891","16044","27232"],carphoria:!0,liveEventStream:!0,autoipacket:["17326","29449","17992","28280","23735","14857","15402","20663","28760","29202","16196","29512","29514","17990","25521","18885","28228","30293","18445","14406","30929","30930"],gubagoochat:["17326","30278","22802","23701","28569","28962","29268","29999","29818","29809","30891","29242","29668","22909","28788","31027","27275","30787","27301","20785","27905","27390","29764","29814","27704","13691","30990","28070","24750","27095","30928","15065"],marketDoctor:!0,pureInfluencer:!0,aiSiteSmartServices:!0,recurrent:!0,vinIqAnalytics:!0,callRevu:!0,automotiveMastermind:["27114","27405","28483","26310","16780","12576","28779","27638","27302","24808","23845","13579","20498","26891","26641","26642","24097","17024","17326","17481","10896","25076","22364","29102","14894","29482","21397"],termly:!0,accuTrade:!0,trustap:!0,kbbtia:!0,Ignitify:["30939","30935","30934","27704","13691","30215","16289","28341","24577","30770","30775","4974","30293","30893","26641","26644","26638","26642","26637","23735","23738","21696","25002","29303","12825","26527","29405","29203","21254","21268","30941","30938","30940","24509"],"700credit":!0,googleTranslate:!0,tekionService:!0,tekion:["30278","26181","26182","26183","30997"],ddcPixall:["22918","23078","30087","22441","16495","14894","27473","26066","26534","25626","15381","30028","28109","25627","20396","20378","26180","26182","26188","25382","30997","26176","26187","26193","25338","26194","26183","26175","26191","29020","22449","28445","21770"],seezarAi:!0,autoFi:["20662","26925","25524","30898","20372","30293","20392","22183","26397","17241","15851","18936","27316","27475","27374","27368","27369","12889","20363","10231"],sunbit:["15885","30940","30939","30945","30941","30938","30935","30934","30885","30892","27843","31338"],dealerSocket:!0,prodigy:["4335","29656","19115","30259","30258","29377","13388","10787","23163"],dealerImagePro:!0,drivably:!0,callRail:["19667","14144"],velocityAutomotiveSolutions:!0,monroneyLabels:!0,ford:["17480","17811","15023","15520"],weglot:!0,deskingAi:!0,clear2Target:["17638"],kelleyBlueBook:["24289"],"360Spyne":!0,tecobi:!0,carCutter:!0,shiftDigitalVWAfterSales:!0,dealerRater:!1,microsoftClarity:!0,fourEyes:["30779","27289","27127","15868","15881","10091","30787","18691","21492","24177","24155","22736","22699","22520","25733","26407","26422"],dealerTeamwork:["28893","25281","29832","24209"],doGoogleAdsEnhancedConversions:!0,matadorChat:["29054","29719","25461","25457","25439","23879","14888","28969","13491","13477","31338"],routeOne:["30252","30253","27546","30980","30983","30780","29383","30267"],schemamarkupIogetStructuredData:["25626","25627","25555","26161","26160","23487","28569","28962","29719","24105","18673","12734","23661","27504","29238","30277"],vinCue:["19423","19389","19400","19408","19397","26157","19401","21049"],hammerWebChat:["30075","27354","22178","21186","21506"],captivatedworks:["24211"],carSaverNissan:["25462","19641","26645"],convertExperiments:["30787"],amazonpixel:["28093","30126","27599","26508","26754"],strolidChat:["26465","26353","21784","25819"],simpliFi:["18672","18585","18948","29049"],deepAutomotive:["27901","27899","27891","27887","22519","14176"],turboReferrals:!0,dealerMcDotCom:["28455"],autoHub:["30152","31404","27083","24806"],smartPixl:["28093","26998","26681","26828","11368"],facebooktracking:["22142","27951","30812","28521","28512","24704","24582","20604"],userWay:["26939"],redlineAdvantage:!0,trueFrame:!0,ladTech:["27843"],promax:["27843","29280"],autoGenius:["27653","27664","27663","17424","17380","17631","17630","23351","23247","21052","21091","21207","23293","23285","23323","23308","23303","27704","13691"],autoCorp:!0,calenGrow:!0,dealerDna:!0,complynet:["27226","27143"],dealerFx:["27937","16714"],glo3d:["28368"],blinkAI:["25733","27843"],dealerFunnel:["25494","26303"],flexpath:["29418","15512"],adsrvr:["15397"],bingUET:["28877"],textium:["29348"],magicURL:["29348"],whisp:["25907","30983","30980"],carSaverNissanV4:!0,greenmonkeyDroidAIPixel:!0,adsrvrV3:!0,mdhv:["29718","29720"],iPredictive:["27269"],extremeReach:["27269"],dealerMade:!0,unityWorks:["11368"]},b=async()=>{var w;const r=document.querySelector('script[src*="harmoniq/init"]');if(!r)return;const t=new URLSearchParams(window.location.search),e=t.get("goToVDP")==="true",o=t.get("enablePartnerDemo");if(t.get("showPartners")==="false"||t.get("showVendors")==="false"||t.get("do_tpi")==="off")return console.warn("Harmoniq: Kill switch is enabled, stopped loading Marketplace based installs.");e&&o&&T();const a=(w=r.getAttribute("src"))!=null&&w.includes("media.assets.sincrod.com")?"prod":"nonprod",c=a==="prod"?"https://media.assets.sincrod.com":"https://media.assets-nonprod.sincrod.com",s=["data-website-provider","data-website-id"];let[i,u]=s.map(m=>r.getAttribute(m)),{packageVersion:p,manifestVersion:v}=await S(u,a)??{};const g=t.get("packageVersion");if(g&&x(g)&&(p=g),!p||!i||!u||!v)return console.error("Harmoniq: Missing required attributes");u.startsWith("do-")&&(u=u.replace("do-",""));try{const f=await(await fetch(`${c}/agency/iq-integration/installations/${u}/manifest_${v}.json`)).json();if(!f)return console.error("Harmoniq: Manifest not found");const h=A(u,f,D);Object.keys(h).length>0&&y(h,p,c,i),t.get("harmoniqInit")==="true"&&Object.keys(h).length===0&&y(f,p,c,i)}catch(m){console.error("Harmoniq: error",m)}};return b(),b});
